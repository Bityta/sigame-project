# ===================================================================
# Lobby Service Configuration
# ===================================================================

spring:
  application:
    name: lobby-service
  
  # ===================================================================
  # R2DBC Configuration - Reactive PostgreSQL Connection
  # ===================================================================
  r2dbc:
    url: r2dbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5433}/${POSTGRES_DB:lobby_db}
    username: ${POSTGRES_USER:lobbyuser}
    password: ${POSTGRES_PASSWORD:lobbypass}
    pool:
      initial-size: 5
      max-size: ${POSTGRES_MAX_CONNS:25}
      max-idle-time: 30m
      validation-query: SELECT 1
  
  # ===================================================================
  # Redis Configuration - Caching and Session Management
  # ===================================================================
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DB:1}
      timeout: 5s
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 2

# ===================================================================
# Server Configuration
# ===================================================================
server:
  port: ${HTTP_PORT:8002}
  shutdown: graceful

# ===================================================================
# Management & Monitoring
# ===================================================================
management:
  endpoints:
    web:
      exposure:
        include: health,prometheus,metrics,info
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      environment: ${ENVIRONMENT:dev}

# ===================================================================
# gRPC Service Configuration
# ===================================================================
grpc:
  auth-service:
    host: ${AUTH_SERVICE_HOST:auth-service}
    port: ${AUTH_SERVICE_PORT:50051}
  pack-service:
    host: ${PACK_SERVICE_HOST:pack-service}
    port: ${PACK_SERVICE_PORT:50055}

# ===================================================================
# Game Service Configuration
# ===================================================================
game-service:
  host: ${GAME_SERVICE_HOST:game-service}
  port: ${GAME_SERVICE_PORT:8003}

# ===================================================================
# Room Configuration
# ===================================================================
room:
  code-length: 6
  code-charset: ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789
  max-players-limit: 12
  cache-ttl: 7200  # 2 hours in seconds

# ===================================================================
# OpenTelemetry Configuration - Distributed Tracing
# ===================================================================
otel:
  exporter:
    otlp:
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://tempo:4317}
  service:
    name: ${OTEL_SERVICE_NAME:lobby-service}
  traces:
    sampler: always_on

# ===================================================================
# Logging Configuration
# ===================================================================
logging:
  level:
    root: INFO
    com.sigame.lobby: ${LOG_LEVEL:DEBUG}
    org.springframework.r2dbc: ${LOG_LEVEL:DEBUG}
    io.r2dbc.postgresql: WARN
  pattern:
    console: '{"timestamp":"%d{yyyy-MM-dd HH:mm:ss.SSS}","level":"%level","service":"${spring.application.name}","trace_id":"%X{trace_id}","span_id":"%X{span_id}","logger":"%logger{36}","message":"%msg"}%n'

# ===================================================================
# SpringDoc OpenAPI Configuration
# ===================================================================
springdoc:
  api-docs:
    path: /api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: method
    tags-sorter: alpha
  show-actuator: false

---
# ===================================================================
# Development Profile
# ===================================================================
spring:
  config:
    activate:
      on-profile: dev

logging:
  level:
    com.sigame.lobby: DEBUG
    org.springframework.r2dbc: DEBUG

---
# ===================================================================
# Production Profile
# ===================================================================
spring:
  config:
    activate:
      on-profile: prod

logging:
  level:
    root: INFO
    com.sigame.lobby: INFO
    org.springframework.r2dbc: WARN

management:
  endpoint:
    health:
      show-details: never

springdoc:
  swagger-ui:
    enabled: false


